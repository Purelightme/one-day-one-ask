B+树是一种非常适合用来做数据库索引的数据结构：

> 很适合磁盘存储，能够充分利用局部性原理，磁盘预读
>
> 很低的树高度，能够存储大量数据
>
> 索引本身占用的内存很小
>
> 能够很好的支持单节点查询，范围查询，有序性查询

### MySIAM的索引

MySIAM的索引与行记录是分开存储的，叫做**非聚集索引**（UnClustered Index）。

其主键索引与普通索引没有本质差异：

- 有连续聚集的区域单独存储航记录
- 主键索引的叶子节点，存储主键，与对应行记录的指针
- 普通索引的叶子节点，存储索引列，与对应行记录的指针

那么也就是说：MySIAM表可以没有主键。

### InnoDB的索引

InnoDB的索引和航记录是存储在一起的，叫做**聚集索引**（Clusted Index）。

- 没有单独区域存储行记录
- 主键索引的叶子节点，存储主键，与对应行记录（**而不是指针**）

所以，InnoDB的PK查询是非常快的。

因为这个特性，InnoDB表<p style="color:red">必须要有聚集索引</p>:

1. 如果定义了PK，则PK就是聚集索引
2. 如果没有定义PK，则第一个费控unique列是聚集索引
3. 否则，InnoDB会创建一个隐藏的row-id作为聚集索引

聚集索引只能有一个！！！聚集索引只能有一个！！！聚集索引只能有一个！！！因为数据行在物理磁盘上只能有一份聚集存储。

InnoDB的普通索引可以有多个，它与聚集索引是不同的：

- 普通索引的叶子节点，存储主键（**也不是指针**）

InnoDB表建议：

> 不建议使用较长的列作为主键，因为所有的普通索引都会存储主键，会导致普通索引过于庞大
>
> 建议使用趋势递增的key做主键，由于数据行与索引一体，这样不至于插入数据时，有大量索引分裂，航记录移动

###总结

MySIAN和InnoDB都使用B+树来实现索引：

- MyISAM的索引与数据分开存储
- MyISAM的索引叶子节点存储指针，主键索引与普通索引无太大区别
- InnoDB的聚集索引和数据行统一存储
- InnoDB的聚集索引存储数据行本身，普通索引存储主键
- InnoDB一定有且只有一个聚集索引
- InnoDB建议使用趋势递增的整数作为PK，而不宜使用较长的列作为PK

### 图解

![8.1](https://raw.githubusercontent.com/Purelightme/one-day-one-ask/master/images/8.1.png)

![8.2](https://raw.githubusercontent.com/Purelightme/one-day-one-ask/master/images/8.2.png)